一周前对概念原型的阐述：

> 作为年底前的“概念原型”目标，至少是在纸上可以手工完成上面的解析、转换（转换出的代码可运行，当然可能返回报错信息）、生成过程。

下面尝试照此进行第一次纸上迭代，编号 0.0.1。待做事项在最后。

## 摄氏转华氏的交互用例

```
> 摄氏度是180

摄氏度是180

> 华氏度是多少

不知华氏度是多少

> 摄氏度是180，不知华氏度是多少

没错

> 华氏度是摄氏度乘9除以5加32

华氏度是摄氏度乘9除以5加32，华氏度是356

> 摄氏度是180，华氏度是356

没错

> 摄氏度200           <----- 摄氏度信息变动，并且省略了“是”

摄氏度是200，华氏度是392  <----- 包括同时变了的华氏度信息

> 华氏度               <---- 省略“是多少”

华氏度是392
```

在对逐个用户输入进行解析之前，先明确支持的语法规则。

## 语法规则

以下用类似 BNF 格式表示的语法规则同时适用于用户输入与反馈信息：
```bnf
多语句 : 语句
      | 多语句 分隔符 语句
语句 : 发问未知值
    | 叙述已知值
    | 叙述关系
    | 无误
发问未知值 : 量 "是" 未知数值
叙述已知值 : 量 "是" 数值
叙述关系 : 量 "是" 算式
算式 : 量 四则运算
四则运算 : 运算符 数值
        | 四则运算 运算符 数值
运算符 : "加" | "乘" | "减" | "除以"
未知反馈 : "不知" 发问未知值
未知数值 : "多少"
量 : "摄氏度" | "华氏度"
数值 : 【自然数】
无误 : "没错"
分隔符 : 逗号
```

反馈信息与用户输入的一些不“对称”之处：
- 用户输入有“发问未知值”，比如“华氏度是多少”，而反馈信息暂无此情况
- 反馈信息有“没错”，用户输入暂没有

感觉不是大问题，以后如需要也可以改为对称。

## 手工逐步演算

各步牵涉的算法尚未结构化，比如反馈算法分散在几步中，尚待合并。

### 摄氏度是180

解析为“叙述已知值”。添加知识条目：
```
{名称: "摄氏度", 值: 180}
```

生成python代码：`摄氏度 = 180`

相关反馈算法：
```
对所有新增的知识条目，输出“{名称}是{值}”，用逗号分隔
```

于是反馈“摄氏度是180”。

当前所有知识：
```
{名称: "摄氏度", 值: 180}
```

### 华氏度是多少

解析为“发问未知值”。在知识条目中搜索名称为“华氏度”的条目，返回空，于是添加知识条目：
```
{名称: "华氏度", 值: None}
```
相关反馈算法：
```
对所有新增的值未知的知识条目，输出“不知{名称}是多少”，用逗号分隔
```
于是反馈“不知华氏度是多少”

当前所有知识：
```
{名称: "摄氏度", 值: 180}
{名称: "华氏度", 值: None}
```

### 摄氏度是180，不知华氏度是多少

解析为“叙述已知值”和“未知反馈”，与现有知识点无冲突。

相关反馈算法：
```
【检验】如果叙述的已知值与知识条目相同，并且未知的量的确未知，则输出“没错”
```

于是反馈“没错”。

### 华氏度是摄氏度乘9除以5加32

解析为“叙述关系”，知识条目新增：
```
{名称: "华氏度", 值: (+ (/ (× 摄氏度 9) 5) 32)}
```

与前类似，反馈输出新增知识条目“华氏度是摄氏度乘9除以5加32”，这里需基于值中的算式生成对应中文。

当前所有知识：
```
{名称: "摄氏度", 值: 180}
{名称: "华氏度", 值: None}
{名称: "华氏度", 值: (+ (/ (× 摄氏度 9) 5) 32)}
```

生成python代码：`华氏度 = 摄氏度 * 9 // 5 + 32`，运行后，再运行新增知识条目的“名称”——“华氏度”，得到返回值为“356”，于是修改值为 None 的条目 `{名称: "华氏度", 值: None}`为：
```
{名称: "华氏度", 值: 356}
```
相关反馈算法：
```
对修改了的知识条目，输出“{名称}是{值}”
```

于是再加反馈“华氏度是356”。

当前所有知识：
```
{名称: "摄氏度", 值: 180}
{名称: "华氏度", 值: 356}
{名称: "华氏度", 值: (+ (/ (× 摄氏度 9) 5) 32)}
```

### 摄氏度是180，华氏度是356

解析为两个“叙述已知值”，通过【检验】，与现有知识点无冲突

反馈“没错”。

### 摄氏度200

分词为：摄氏度 200，分别为“量”和“数值”。
```
【获取最近语义】具备此两项且无需其他实词的句式，只有“叙述已知值”
```

中间添加“是”后，成为“叙述已知值”。修改知识库条目：
```
{名称: "摄氏度", 值: 200}
```

当前所有知识：
```
{名称: "摄氏度", 值: 200}
{名称: "华氏度", 值: 356}
{名称: "华氏度", 值: (+ (/ (× 摄氏度 9) 5) 32)}
```

修改了条目后，寻找所有“值”中包含“摄氏度”的条目， 再次运行算式进行更新：
```
{名称: "华氏度", 值: 392}
```

反馈所有修改的条目“摄氏度是200，华氏度是392”。

当前所有知识：
```
{名称: "摄氏度", 值: 200}
{名称: "华氏度", 值: 392}
{名称: "华氏度", 值: (+ (/ (× 摄氏度 9) 5) 32)}
```

### 华氏度

分词为：华氏度，为“量”。【获取最近语义】为“发问未知值”，于是补上“是 多少”。

相关反馈算法：
```
在知识库中搜到名称为“华氏度”的条目，返回对应值 392
```

反馈“华氏度是392”。


## 待做事项

- 知识库相关操作与数据结构整理
  - “华氏度”相关有数值和算式两种内容
  - 为算式确定数据结构，以及如何生成对应中文
  - 今后也许根据需要添加更多信息，比如条目添加的时间戳
- 合并反馈算法
- 【获取最近语义】的具体算法需细化
- 如何在更新“摄氏度”值后自动更新“华氏度”值
- 起草大概架构
- 生成后端语言与运行的细节
