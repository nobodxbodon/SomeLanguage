## [知乎链接](https://www.zhihu.com/question/349028712/answer/2220729987)

欢迎到 [gitee](https://gitee.com/zhishi/SomeLanguage) 或 [github](https://github.com/nobodxbodon/SomeLanguage) 库交流。

----

2021-11-19

打算先确定一下交互环境的语境。在设计交互表达方式时遵照这一语境，尽量顺畅合理。

默认情况下，输入和反馈都是针对“当前”的信息。比如“摄氏度是180”，我虽然需要的是烤箱加热后到达的华氏温度数值，但如果仅为了换算成华氏度，对我来说语义可以简化为“当前温度是180摄氏度”。

在这一语境下，每次用户输入都会引发当前信息的变动，比如“摄氏度是180”，计算机就多了“已知摄氏度是180”这一信息。由此，本交互环境的反馈机制可以定为：计算机将每次接受输入之后引发的当前信息的变动表达出来。

下面逐句明确语义，并同时设计对应语法。

之前的“180摄氏度是多少华氏度？”，由于“180摄氏度”的表述并不直接在语法层面显式表明“180”和“摄氏度”之间的关系，于是决定改用“摄氏度是180”，并将后半句语序改为“华氏度是多少”使得语法与前半句一致，整句如下：

```
摄氏度是180，华氏度是多少
```
这里“多少”的语义为一个未知的数值。另一个搜索大文件的用例中，多半就不会用“多少”表述，而是用比如“哪些”，表示一些未知的个体。

昨天建模有个忽视的问题。按照交互环境的功能定义，仅根据“摄氏度是180，华氏度是多少”，并不能推断华氏度必须仅靠摄氏度得到，因为可能需要或可以倚靠其他内置或是上下文输入的信息（即“知识”）获得未知的华氏度数值。

那么，在用户输入“摄氏度是180，华氏度是多少”之后，根据反馈机制，在华氏度无法获得时，当前信息的变动为“摄氏度是180，华氏度未知”。这样反馈信息都为肯定句。

“华氏度是摄氏度乘9除以5加32”句法相同（..是..）无需变动。

“180摄氏度是356华氏度”如果是反馈信息，简化为“华氏度是356”，因为“摄氏度是180”是已知信息、并无变动。

“没错”表达的是没有任何信息变动，可以继续保留。

下面是重新设计的示例会话，后面有新输入“摄氏度是200”：
```
> 摄氏度是180，华氏度是多少

摄氏度是180，华氏度未知

> 摄氏度是180，华氏度未知

没错

> 华氏度是摄氏度乘9除以5加32

华氏度是356

> 摄氏度是180，华氏度是356

没错

> 摄氏度是200           <----- 摄氏度信息变动

摄氏度是200，华氏度是392  <----- 反馈中包括同时变了的华氏度信息
```

“摄氏度和华氏度的关系是什么？”这句暂未想到如何重新表达，但对用例来说暂不需要，先略过。另外还有输入矛盾信息如“摄氏度是180，华氏度是300”如何反馈待定。

【预告周末也许停更】

----

2021-11-18

从昨天的想象示例想到，反馈信息使用编程语言语法的一个好处是：用户可以看反馈信息“学着写”，因为反馈信息都是正确代码。

以这个摄氏转华氏的示例为目标开始第一次原型搭建迭代，编号 0.0.1。

## 交互环境功能

界面暂为传统的基于文本的交互环境：

1. 提示用户输入
2. 用户输入后以某按键（如回车）结束
3. 显示反馈信息，继续第一步

如果用户输入无法解析，包括空内容，暂时返回空反馈信息并继续提示用户输入。

当前会话中的历史内容为上下文，包括用户输入和反馈信息。
## 语言表达与建模

句式上有疑问句和肯定句两种。疑问句表达需要某个未知量。如：“180摄氏度是多少华氏度？”、“摄氏度和华氏度的关系是什么？”

肯定句表达的是已知的内容，比如：“华氏度是摄氏度乘9除以5加32”、“180摄氏度是356华氏度”、“没错”。

其中“没错”表示所有上下文的已知内容没有任何逻辑矛盾。用户输入错误内容比如“180摄氏度是300华氏度”时，会反馈错误并给出正确数值。已为此调研咨询使用定理证明辅助工具达成此部分功能。

### 内容建模

语法规则提取如果仅靠用例中初步设想的表达方式，可能有冗余。为用尽量简约的语法满足用例需要，打算先对用例中的各表述纳入某种模型，以确定语义和表达要素。

暂围绕“已知/未知”粗略建模如下：
```
180摄氏度是多少华氏度？=> 已知：180 ℃；未知：多少 ℉ 与之相等

摄氏度和华氏度的关系是什么？=> 未知：已知 ℃ 时如何得知 ℉

华氏度是摄氏度乘9除以5加32 => 已知：已知 ℃ 时如何得知 ℉

180摄氏度是356华氏度 => 已知：180 ℃ 与 356 ℉ 相等

没错 => 已知：无逻辑错误
```
发现一个之前表述上的问题：“摄氏度和华氏度的关系是什么？”并不明确。因为还有已知 ℉ 时如何得知 ℃ 这种反向关系。此处应选择更明确的表达方式。

--------------

2021-11-17

昨天在评论区探讨了些实现细节问题例如解释/编译型等。还是先描述一下设想的模样和打算吧。

比如昨天的温度转换用例，在某语言交互环境中，可能是这样（>为用户输入）：
```
> 180摄氏度是多少华氏度？

摄氏度和华氏度的关系是什么？

> 华氏度是摄氏度乘9除以5加32

180摄氏度是356华氏度
```
由于反馈信息与用户输入的语法一致，反馈信息可以作为用户输入并得到对应反馈，比如：
```
> 摄氏度和华氏度的关系是什么？

华氏度是摄氏度乘9除以5加32

> 180摄氏度是356华氏度

没错
```


在原型实现方面，由于时间紧迫，主要实现“前端”，将“后端”交由现有编程语言或是其他工具。所谓“前端”，主要是中文的解析、转换、生成上，其中“转换”会视需求转换为一个也可能多个现有编程语言的代码。比如需要简单推导的话，也许用逻辑式语言表达更简明。

作为年底前的“概念原型”目标，至少是在纸上可以手工完成上面的解析、转换（转换出的代码可运行，当然可能返回报错信息）、生成过程。当然能在代码中实现越多越好。

鉴于早期迭代可以完全在纸上进行，打算在本月尽早开始第一个迭代。视情况再决定下个月计划。

---

2021-11-16

## 工程规划

宗旨是用尽可能小的代价达成尽可能多的目标。即便不能完成所有目标，至少明确“能做到”的边界以及原因。

### 实用用例

来自个人日常生活

- 摄氏转华氏：食谱里的温度是比如 180 摄氏度，而烤箱需要设置华氏度值，需要换算。反过来换算的时候较少。
- 找本地所有大文件（及大文件夹）：电脑用的久了要找哪些地方有大垃圾。于是搜索在某目录下的超过比如 500MB 的文件（和文件夹）

可能牵涉到的功能有：
- 算术、比较
- 遍历、条件
- 量之间的关联

### 设计取舍

综合理想目标和实际情况得出的设计目标先后排序：

- 计算机反馈的信息也使用此语言：意味着交互环境的双向信息都被纳入语言设计考虑的范畴，反馈信息包括正确结果返回、提示、报错等的关键内容都需通过“某语言”表达。这是前人经验相对极少（或者说无特意关注）的方向，也是本项目的最大特色之一。
- 用户尽量不依赖编程专业概念：根据 20/80 原则，20% 的最常用功能可覆盖 80% 的最常见需求，在软件上，也许比例更加悬殊。在设计过程中，引入任何专业概念前都需推敲是否必要。比如作用域（scope）可考虑舍去，即便会导致语言功能削弱。
- 可扩展实现其他编程语言的功能：对实践和理论的要求较高，万一有余力则作些验证。

简言之，只要在年底之前能够支持两个实用用例，与上述设计目标无直接关联的其他一切语言特性都可以舍去。比如图灵完备。

接下去根据年底之前完成概念原型搭建这一目标继续落实计划，包括确定“概念原型”的含义、时间分配等

------------------------
2021-11-15（一）

下面将理想目标逐步现实化。

## 目标用户和人手

至少在概念成型之前，几乎肯定是个单人项目。鉴于 [Ruby 作者松本行弘对编程语言设计者的建议](https://zhuanlan.zhihu.com/p/93495675)：

> 自己想用就足够了

设计和功能都以自用为出发点。

昨天已阐述尽量在设计中使用自然语言语法。由于个人母语是中文，于是选用中文语法设计语言。在之后的实现中将尽量用中文命名（[实践体验比较舒适](https://zhuanlan.zhihu.com/p/261451253) ）。

鉴于人力有限，将在各阶段实现中尽可能利用现有各种编程语言生态和其他领域现有工具，以降低开发成本。

--------------------


2021-11-14

对三个目标倒序展开。

## 3 可扩展实现其他编程语言的功能

该语言的设计和实现都支持较容易地通过扩展实现其他各种编程语言的当前以及未来功能，以保证它的持续生命力。

为此需尽量避免对特殊符号相关语法的依赖，以避免同样符号在不同语言的用途有别导致在扩展时的设计难度。

## 2 计算机反馈的信息也使用此语言

用户输入和计算机反馈的两方面信息都使用同一语言，使用户有一致的体验也更利于理解反馈信息。

为此有两种可能：
- 都不使用自然语言语法
- 都使用自然语言语法

结合第三点的需求，加上可读性需要，选择尽量使用自然语言语法。

## 1 用户不需了解编程术语便可使用

现有编程语言的反馈信息和文档等都多少包含编程术语，包括数据结构如“数组”、各种语言的范式相关术语如“对象”等。与第三点类似，这些编程相关术语可以通过扩展加入。但用户不需依赖这些术语也可使用该语言并理解反馈信息，可以让用户专注于业务需求和实现思路。

这需要基于用户描述的业务特性选择合适的数据结构等实现细节，仅在少数情况如需进一步优化时让用户选择。

-------------------

2021-11-13

“某语言”的理想目标如下：

1. 用户不需了解编程术语便可使用
2. 计算机反馈的信息也使用此语言
3. 可扩展实现其他编程语言的功能

如果已有类似项目请不吝告知。

【细化目标待续】

--------------

使用中文自然语言语法是一个方向：[中文想在编程语言方面弯道超车有哪些可行的路线?](https://www.zhihu.com/question/483359591/answer/2096999846)（[库内备份](2021-08-30-中文想在编程语言方面弯道超车有哪些可行的路线?.md)）

尽量在 2021 年底之前出个概念原型，有兴趣的欢迎追更。
